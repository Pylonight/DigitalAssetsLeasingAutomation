<html>
<head>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<script src="https://code.highcharts.com/stock/highstock.js"></script>
	<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
	<script src="https://code.highcharts.com/stock/modules/export-data.js"></script>
</head>

<body>
	<div id="container" style="width:100%; height:100%;"></div>
</body>

<script>
var chart; // globally available
$(function() {
	chart = Highcharts.stockChart('container', {
		chart: {
			type: 'spline',
			events: {
				load: updateStock
			}
		},
		title: {
			text: 'Billboard Price Chart (Valuation drawn from normal distribution (100, 50))'
		},
		xAxis: {
			type: 'datetime',
			tickPixelInterval: 150,
			maxZoom: 20*1000
		},
		yAxis: {
			minPadding: 0.2,
			maxPadding: 0.2,
			title: {
				text: 'Price',
				margin: 80
			}
		},
		rangeSelector: {
			selected: 1
		},
		series: [{
			name: 'Price',
			data: [[Date.now(), 1]] // predefined JavaScript array
		}]
	});
});

function gaussian(mean, stdev) {
	var y2;
	var use_last = false;
	return function() {
		var y1;
		if(use_last) {
			y1 = y2;
			use_last = false;
		}
		else {
			var x1, x2, w;
			do {
				x1 = 2.0 * Math.random() - 1.0;
				x2 = 2.0 * Math.random() - 1.0;
				w  = x1 * x1 + x2 * x2;               
			} while( w >= 1.0);
			w = Math.sqrt((-2.0 * Math.log(w))/w);
			y1 = x1 * w;
			y2 = x2 * w;
			use_last = true;
		}

		var retval = mean + stdev * y1;
		if(retval > 0) 
			return retval;
		return -retval;
	}
}
var standard = gaussian(100, 50);

var RISEFACTOR = 1.1;

var rigidPrice = 1;
var currentPrice = rigidPrice;
var lastPrice = currentPrice;
var realPrice = 0;

var expireCount = 0;
var leaseTerm = 7;

function updateStock() {
	if (typeof chart != 'undefined') {
		var valuation = standard();
		if (currentPrice <= valuation) {
			realPrice = lastPrice;
			lastPrice = valuation;
			currentPrice = valuation*RISEFACTOR;
			expireCount = 0;
		} else if (++expireCount >= leaseTerm) {
			currentPrice /= 2;
			lastPrice = currentPrice;
			realPrice = 0;
			expireCount = 0;
		}

		var series = chart.series[0];
		var	shift = series.data.length > 2000;
		chart.series[0].addPoint([Date.now(), currentPrice], true, shift);
	}
	setTimeout(updateStock, 1000);
}

</script>
</html>